%%===========================================================
%%  Package: xememoir.sty –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –ø–∞–∫–µ—Ç–∞
%%  Version: v3.0 (Refactor Branch)
%%  –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: XeLaTeX, LuaLaTeX, –∫–ª–∞—Å—Å memoir
%%  –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: 2025-11-01
%%  Author: Valery
%%-----------------------------------------------------------
%%  Description:
%%      –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –¥–ª—è –∫–ª–∞—Å—Å–∞ `memoir`, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
%%      –ø–æ–¥ XeLaTeX. –°–æ–¥–µ—Ä–∂–∏—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã, —Ñ–ª–∞–≥–∏ –∏
%%      –≤—ã–∑–æ–≤—ã –º–æ–¥—É–ª–µ–π –ø–∞–∫–µ—Ç–∞ xememoir.sty.
%%      –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
%%      –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Å—Ç–∞—Ä—É—é/–Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π.
%%
%%  Encoding: UTF-8
%%  Engine:   XeLaTeX
%%  License:  MIT
%%-----------------------------------------------------------
%%  Change Log:
%%      v3.0 - –ü–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ xememoir:
%%             * –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
%%             * –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
%%             * –¥–æ–±–∞–≤–ª–µ–Ω—ã NOTE/TODO/FIX –º–µ—Ç–∫–∏
%%             * —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–æ–≤
%%             * –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ kvoptions
%%===========================================================

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{xememoir}[2025/11/01 v3.0 Refactored memoir setup for XeLaTeX]
\RequirePackage{xememoir-flags}

% ======================================================================
% üîí  –ü—Ä–æ–≤–µ—Ä–∫–∞ memoir
% ======================================================================
\@ifclassloaded{memoir}{}{
  \PackageError{xememoir}{This package requires the 'memoir' document class.}
  {Use \string\documentclass\{memoir\} in your main .tex file.}
}

% ======================================================================
% üì¶  –ë–ê–ó–û–í–´–ï –ü–ê–ö–ï–¢–´
% ======================================================================
\RequirePackage{etoolbox}
\RequirePackage{fontspec}
\PassOptionsToPackage{table,xcdraw}{xcolor}
\RequirePackage{xcolor}
\RequirePackage{microtype}

% ======================================================================
% üß©  –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ú–û–î–£–õ–ï–ô –ü–û –†–ï–ñ–ò–ú–£
% ======================================================================
\ifxememoir@usenew
% ‚úÖ –ù–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

% --- 0Ô∏è‚É£ –Ø–∑—ã–∫–∏ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
\InputIfFileExists{langsetup.sty}{}{%
  \typeout{[xememoir] langsetup.sty not found, using polyglossia defaults.}%
}

% --- 1Ô∏è‚É£ –®—Ä–∏—Ñ—Ç—ã
\InputIfFileExists{xememoir-fonts.sty}{}{%
  \typeout{[xememoir] xememoir-fonts.sty not found, fallback to fontswitch.sty.}%
  \InputIfFileExists{fontswitch.sty}{}{%
    \typeout{[xememoir] fontswitch.sty not found, using fontspec defaults.}%
  }%
}

% --- 2Ô∏è‚É£ Layout (–ø–æ–ª—è, –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª—ã)
\InputIfFileExists{xememoir-layout.sty}{}{%
  \typeout{[xememoir] xememoir-layout.sty not found, fallback to layoutsetup.sty.}%
  \InputIfFileExists{layoutsetup.sty}{}{%
    \typeout{[xememoir] layoutsetup.sty not found, using memoir defaults.}%
  }%
}

% % --- 3Ô∏è‚É£ Graphics (–≥—Ä–∞—Ñ–∏–∫–∞ –∏ –ø—Ä–æ—Ñ–∏–ª–∏)
% \InputIfFileExists{xememoir-graphics.sty}{}{%
%   \typeout{[xememoir] xememoir-graphics.sty not found, fallback to graphicssetup.sty.}%
%   \InputIfFileExists{graphicssetup.sty}{}{%
%     \typeout{[xememoir] graphicssetup.sty not found, using defaults.}%
%   }%
% }

% % --- 4Ô∏è‚É£ Lists (—Å—Ç–∏–ª–∏ —Å–ø–∏—Å–∫–æ–≤)
% \InputIfFileExists{xememoir-lists.sty}{}{%
%   \typeout{[xememoir] xememoir-lists.sty not found, fallback to enumsetup.sty.}%
%   \InputIfFileExists{enumsetup.sty}{}{%
%     \typeout{[xememoir] enumsetup.sty not found, using defaults.}%
%   }%
% }

% % --- 5Ô∏è‚É£ Bibliography (–ì–û–°–¢ / GOST)
% \InputIfFileExists{xememoir-bib.sty}{}{%
%   \typeout{[xememoir] xememoir-bib.sty not found, fallback to bibsetup.sty.}%
%   \InputIfFileExists{bibsetup.sty}{}{%
%     \typeout{[xememoir] bibsetup.sty not found, using defaults.}%
%   }%
% }

% % ---  6Ô∏è‚É£  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (math, tables, bib, todo, listings, pdf)
% \InputIfFileExists{xememoir-modules.sty}{}{%
%   \typeout{[xememoir] xememoir-modules.sty not found, fallback to old modules.}%
%   \InputIfFileExists{mathsetup.sty}{}{\typeout{[xememoir] mathsetup.sty not found, using defaults.}}%
%   \InputIfFileExists{tablesetup.sty}{}{\typeout{[xememoir] tablesetup.sty not found, using defaults.}}%
%   \InputIfFileExists{todo-setup.sty}{}{\typeout{[xememoir] todo-setup.sty not found, using defaults.}}%
%   \InputIfFileExists{listingssetup.tex}{}{\typeout{[xememoir] listingssetup.tex not found, using defaults.}}%
%   \InputIfFileExists{pdf-setup.sty}{}{\typeout{[xememoir] pdf-setup.sty not found, using defaults.}}%
%   %\InputIfFileExists{bibsetup.sty}{}{\typeout{[xememoir] bibsetup.sty not found, using defaults.}}%
% }

\else
% ‚ö†Ô∏è –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
\typeout{[xememoir] Using old module loading logic.}%
% –ó–¥–µ—Å—å –≤—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ include/require –±–ª–æ–∫–∏, —á—Ç–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
\fi

% ======================================================================
% üîó  Hyperref (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏–º)
% ======================================================================
\IfFileExists{hyperref.sty}{%
  \PassOptionsToPackage{unicode}{hyperref}%
  \RequirePackage{hyperref}%
  \hypersetup{%
    colorlinks=true,
    linkcolor=blue,
    citecolor=blue,
    urlcolor=blue,
    bookmarksnumbered=true,
    bookmarksopen=true,
    bookmarksopenlevel=1
  }%
}{}

% ======================================================================
% üìù  DIAGNOST–ò–ö–ê –ê–ö–¢–ò–í–ù–´–• –§–õ–ê–ì–û–í
% ======================================================================
\AtEndOfPackage{%
  \typeout{[xememoir] Active font flags: ms=\if@xem@ms, liberation=\if@xem@liberation, cmu=\if@xem@cmu}%
  \typeout{[xememoir] Active bookstyle flags: classic=\if@xem@classic, modern=\if@xem@modern, academic=\if@xem@academic, poetry=\if@xem@poetry, technical=\if@xem@technical, elegant=\if@xem@elegant, compact=\if@xem@compact, bold=\if@xem@bold}%
  \typeout{[xememoir] Active graphicstyle flags: classic=\if@xemg@classic, colorful=\if@xemg@colorful, minimal=\if@xemg@minimal, technical=\if@xemg@technical, presentation=\if@xemg@presentation}%
  \typeout{[xememoir] Active liststyle flags: gost=\if@xeml@gost, numeric=\if@xeml@numeric, mixed=\if@xeml@mixed, alpha=\if@xeml@alpha}%
}

\endinput
