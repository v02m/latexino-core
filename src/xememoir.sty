%%===========================================================
%%  Package: xememoir.sty Центральный модуль пакета
%%  Version: v3.0 (Refactor Branch)
%%  Совместимость: XeLaTeX, LuaLaTeX, класс memoir
%%  Рефакторинг: 2025-11-01
%%  Author: Valery
%%-----------------------------------------------------------
%%  Description:
%%      Основной модуль для класса `memoir`, адаптированный
%%      под XeLaTeX. Содержит системные макросы, флаги и
%%      вызовы модулей пакета xememoir.sty.
%%
%%  Encoding: UTF-8
%%  Engine:   XeLaTeX
%%  License:  MIT
%%-----------------------------------------------------------
%%  Change Log:
%%      v3.0 - Полный рефакторинг xememoir:
%%             * По возможности сохранены все комментарии Valery
%%             * исправлены синтаксические ошибки
%%             * добавлены NOTE/TODO/FIX метки
%%             * унифицирована структура блоков
%%             * подготовка к kvoptions
%%===========================================================
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{xememoir}[2025/11/01 v1.0 Центральный модуль настроек]

%% ===============================
%%  ФЛАГИ ПРОФИЛЕЙ
%% ===============================
\newif\ifusefonts      % Включение пользовательских шрифтов
\newif\ifuselayout     % Включение макета страницы
\newif\ifusegraphics   % Включение графических профилей
\newif\ifuselistings   % Включение настроек листингов
\newif\ifusetables     % Включение таблиц
\newif\ifusemath       % Включение математических макросов
\newif\ifusebib        % Включение библиографии
\newif\ifusetodo       % Включение TODO заметок
\newif\ifusedraft      % Включение режима черновика

% Флаги по умолчанию
\usefontstrue
\uselayouttrue
\usegraphicstrue
\uselistingstrue
\usetablesthru
\usemathtrue
\usebibtrue
\usetodotrue
\usedrafttrue

%% ===============================
%%  ЗАГРУЗКА ПАКЕТОВ
%% ===============================
\RequirePackage{ifthen}
\RequirePackage{xcolor}
\RequirePackage{polyglossia}
\RequirePackage{tikz}
\RequirePackage{geometry}
\RequirePackage{microtype}
\RequirePackage{hyperref}

%% ===============================
%%  ШРИФТЫ
%% ===============================
\ifusefonts
\RequirePackage{fontspec}
\input{xememoir-fonts.sty}  % Модуль выбора шрифтов
\fi

%% ===============================
%%  МАКЕТ
%% ===============================
\ifuselayout
\input{xememoir-layout.sty}  % Модуль настройки полей, колонтитулов, профилей
\fi

%% ===============================
%%  ГРАФИКА
%% ===============================
\ifusegraphics
\input{xememoir-graphics.sty}
\fi

%% ===============================
%%  СПИСКИ
%% ===============================
\input{xememoir-enum.sty}

%% ===============================
%%  МАТЕМАТИКА
%% ===============================
\ifusemath
\input{xememoir-math.sty}
\fi

%% ===============================
%%  ТАБЛИЦЫ
%% ===============================
\ifusetables
\input{xememoir-tables.sty}
\fi

%% ===============================
%%  БИБЛИОГРАФИЯ
%% ===============================
\ifusebib
\input{xememoir-bib.sty}
\fi

%% ===============================
%%  TODO ЗАМЕТКИ
%% ===============================
\ifusetodo
\input{xememoir-todo.sty}
\fi

%% ===============================
%%  ЛИСТИНГИ
%% ===============================
\ifuselistings
\input{xememoir-listings.sty}
\fi

%% ===============================
%%  PDF МЕТАДАННЫЕ
%% ===============================
\input{xememoir-pdf.sty}

%% ===============================
%%  РЕЖИМ ЧЕРНОВИКА
%% ===============================
\ifusedraft
\newcommand{\draftnote}[1]{\textcolor{red}{#1}}
\else
\newcommand{\draftnote}[1]{}
\fi

%% ==========================================================
%%  Конец файла xememoir.sty
%% ==========================================================
